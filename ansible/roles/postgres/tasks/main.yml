---
- name: Setup PostgreSQL
  block:
    - name: Create postgresql data directory
      file:
        path: "{{ postgres_data_dir }}"
        state: directory
        owner: "{{ postgres_user_id }}"
        group: "{{ postgres_group_id }}"
        mode: "0755"
        recurse: true

    - name: Create postgresql log directory
      file:
        path: "{{ postgres_log_dir }}"
        state: directory
        owner: "{{ postgres_user_id }}"
        group: "{{ postgres_group_id }}"
        mode: "0775"
        recurse: true

    - name: Create postgresql config directory
      file:
        path: "{{ postgres_config_dir }}"
        state: directory
        mode: '0755'

    - name: Start postgresql service
      community.docker.docker_compose_v2:
        project_src: "{{ postgres_config_dir }}"
  when: not ansible_check_mode

- name: Template docker-compose for postgresql
  template:
    src: docker-compose.yml.j2
    dest: "{{ postgres_config_dir }}/docker-compose.yml"
    mode: '0644' 