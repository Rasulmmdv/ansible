---
# defaults file for restic
# NOTE: Some variables must be set in your playbook or inventory (see playbook example)

# Default project name - must be set in playbook or inventory
# project_name: "your-project-name"  # Set in playbook

# Base directories - these will be calculated from project_name and restic_instance_name
# but can be overridden individually in playbook
restic_instance_name: backup
restic_base_dir: "/opt/{{ project_name }}/{{ restic_instance_name }}"
restic_config_dir: "{{ restic_base_dir }}/config"
restic_log_dir: "{{ restic_base_dir }}/logs"
restic_cache_dir: "{{ restic_base_dir }}/cache"
restic_scripts_dir: "{{ restic_base_dir }}/scripts"

# User and group
restic_user: "restic"
restic_group: "restic"

# Restic repository configuration
# Default to Yandex Cloud - can be overridden in playbook
restic_repository: "s3:https://storage.yandexcloud.net/backupsdi"
restic_repository_type: "s3"  # Options: s3, local, sftp, rest, azure, gs, swift
# restic_repository_path: ""  # For local repositories (set in playbook if needed)

# # AWS S3 configuration (when using S3 backend)
# # Default credentials for check mode - should be overridden in production
# restic_aws_access_key_id: "changeme"
# restic_aws_secret_access_key: "changeme"
restic_aws_region: "ru-central1"
restic_aws_endpoint: "storage.yandexcloud.net"

# # Selectel S3 specific configuration
# restic_s3_endpoint_url: "https://s3.ru-7.storage.selcloud.ru"
restic_s3_endpoint_url: "storage.yandexcloud.net"
restic_s3_ca_bundle: "{{ restic_config_dir }}/selectel-ca.crt"
# restic_setup_selectel_ca: true

# Repository password (required for all repository types)
# Default password - should be overridden in production for security
# restic_password: "changeme"

# Backup configuration
restic_backup_paths:
  - "/data"
  - "/opt"
  - "/etc"
  - "/home"
  - "/root"

# Restic retry configuration for transient failures (repo locks, network hiccups, etc.)
# When multiple hosts share the same repository, locks can cause conflicts.
# These settings make backups more resilient by retrying with exponential backoff.
restic_backup_retry_attempts: 12                # Total attempts (including first try)
restic_backup_retry_base_sleep_seconds: 300     # 5 minutes - base delay for exponential backoff
restic_backup_retry_max_sleep_seconds: 1800     # 30 minutes - cap per retry
# Pattern: 5m, 10m, 15m, 20m, 25m, 30m, 30m, 30m, 30m, 30m, 30m (total ~3-4 hour window)

# PostgreSQL backup configuration
# Set to true in your inventory/playbook for hosts with databases
restic_postgresql_backup_enabled: false
restic_postgresql_backup_dir: "{{ restic_base_dir }}/db-dumps"
restic_postgresql_retention_days: 7  # Keep database dumps for 7 days locally

# Additional backup paths (will be added to restic_backup_paths when PostgreSQL backup is enabled)
restic_postgresql_backup_paths:
  - "{{ restic_postgresql_backup_dir }}"

restic_exclude_patterns:
  - "*.tmp"
  - "*.log"
  - "*.cache"
  - "/tmp/*"
  - "/var/tmp/*"
  - "/var/cache/*"
  - "node_modules"
  - ".git"
  - "/etc/*"

# Retention policy
restic_keep_last: 7      # Keep last 7 snapshots
restic_keep_daily: 7     # Keep daily snapshots for 7 days
restic_keep_weekly: 4    # Keep weekly snapshots for 4 weeks
restic_keep_monthly: 6   # Keep monthly snapshots for 6 months
restic_keep_yearly: 2    # Keep yearly snapshots for 2 years

# Backup schedule
restic_backup_schedule: "*-*-* 02:00:00"  # Daily at 2 AM
# Randomized delay in systemd timer (in seconds) - helps spread backups when multiple hosts start simultaneously
# Default 10800 = 180 minutes, meaning backups can start anywhere from 02:00 to 05:00
restic_backup_randomized_delay_seconds: 10800
restic_prune_schedule: "Sun *-*-* 04:00:00"   # Weekly on Sunday at 4 AM
restic_check_schedule: "Sun *-*-* 05:00:00"   # Weekly on Sunday at 5 AM

# Systemd service configuration
restic_service_name: "restic_backup"
restic_service_description: "Restic Backup Service"
restic_service_type: "oneshot"
restic_service_restart: "no"

# Logging
restic_log_level: "info"
restic_log_file: "{{ restic_log_dir }}/restic.log"
restic_backup_log_file: "{{ restic_log_dir }}/backup.log"

# Notification settings
# restic_notification_email: ""  # Set in playbook if needed
# restic_notification_webhook: ""  # Set in playbook if needed

# Security
restic_encryption_enabled: true
restic_verify_backups: true

# Monitoring and health checks
restic_health_check_enabled: true
restic_health_check_interval: 3600  # 1 hour

# System packages required
restic_system_packages:
  - restic
  - python3
  - python3-pip
  - curl
  - gnupg
  - ca-certificates
  - systemd
  - openssl
  - wget
  - postgresql-client
# Python packages required
restic_python_packages: [] 

# PostgreSQL instances configuration
restic_postgresql_instances: []
  # Example:
  # - container_name: "{{ project_name }}_postgres"  # Optional if not container
  #   host: "localhost"  # Required if is_container: false
  #   is_container: true  # Default: true
  #   username: "postgres"
  #   password: "password"
  #   port: 5432
  #   databases: 'all'  # Use 'all' to backup all non-template databases, or list specific ones: ['db1', 'db2'] 