services:
  postgres:
    image: postgres:14
    container_name: "{{ project_name }}_{{ postgres_instance_name }}"
    restart: always
    command: postgres -c 'logging_collector=on' -c 'log_directory=/var/log/postgresql'
    environment:
      POSTGRES_USER: "{{ postgres_user }}"
      POSTGRES_PASSWORD: "{{ postgres_password }}"
      POSTGRES_DB: "{{ postgres_db }}"
    ports:
      - "{{ postgres_port }}:5432"
    volumes:
      - "{{ postgres_data_dir }}:/var/lib/postgresql/data:z"
      - "{{ postgres_log_dir }}:/var/log/postgresql:z"
    deploy:
      resources:
        limits:
          cpus: "{{ postgres_cpu_limit }}"
          memory: "{{ postgres_mem_limit }}" 