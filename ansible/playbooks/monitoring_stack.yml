---
# Playbook: monitoring_stack.yml
# Description: Deploy Full Monitoring and Observability Stack
# Usage: 
#   From ansible/ directory: ansible-playbook playbooks/monitoring_stack.yml -e "target_hosts=personal"
#   From root directory: ANSIBLE_CONFIG=ansible/ansible.cfg ansible-playbook -i ansible/all ansible/playbooks/monitoring_stack.yml -e "target_hosts=personal"

- name: Deploy Full Monitoring and Observability Stack
  hosts: "{{ target_hosts | default('all') }}"
  become: true
  roles:
    - { role: monitoring-stack, tags: ["monitoring"] }
  
  post_tasks:
    - name: Validate monitoring stack deployment
      include_role:
        name: monitoring-stack
        tasks_from: validate
      tags: ["validate", "never"]
      when: monitoring_config.validate_deployment | default(true)
    
    - name: Display deployment summary
      debug:
        msg:
          - "=== Monitoring Stack Deployment Complete ==="
          - "Prometheus: http://{{ ansible_default_ipv4.address }}:9090"
          - "Grafana: http://{{ ansible_default_ipv4.address }}:3000 (admin/admin)"
          - "Alertmanager: http://{{ ansible_default_ipv4.address }}:9093"
          - "Loki: http://{{ ansible_default_ipv4.address }}:3100"
          - "Run with --tags validate to validate deployment" 