# Restic Repository Configuration
export RESTIC_REPOSITORY={{ restic_repository }}
export RESTIC_PASSWORD={{ restic_password }}

# AWS S3 Configuration (if using S3 backend)
{% if restic_repository_type == "s3" %}
export AWS_ACCESS_KEY_ID={{ restic_aws_access_key_id }}
export AWS_SECRET_ACCESS_KEY={{ restic_aws_secret_access_key }}
export AWS_DEFAULT_REGION={{ restic_aws_region }}
# Custom S3 endpoint configuration
{% if restic_s3_endpoint_url is defined and restic_s3_endpoint_url %}
export AWS_S3_ENDPOINT={{ restic_s3_endpoint_url }}
{% endif %}
# SSL Certificate configuration for custom S3 endpoints
{% if restic_s3_ca_bundle is defined and restic_s3_ca_bundle and restic_setup_selectel_ca | bool %}
export AWS_CA_BUNDLE={{ restic_s3_ca_bundle }}
{% endif %}
# AWS SDK Retry Configuration for S3 eventual consistency
# Increase retry attempts to handle transient S3 errors (e.g., "key does not exist")
# This helps with S3 eventual consistency issues during long-running backups
export AWS_MAX_ATTEMPTS=10
export AWS_RETRY_MODE=adaptive
# S3-specific retry configuration
export AWS_S3_MAX_RETRIES=10
{% endif %}

# Restic Cache Configuration
export RESTIC_CACHE_DIR={{ restic_cache_dir }}

# Logging Configuration
export RESTIC_LOG_LEVEL={{ restic_log_level }}

# Performance Configuration
export RESTIC_READ_CONCURRENCY=2
export RESTIC_WRITE_CONCURRENCY=2 