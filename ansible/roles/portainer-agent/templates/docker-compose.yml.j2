version: '3.8'

services:
  portainer-agent:
    image: {{ portainer_agent_image }}
    container_name: portainer-agent
    restart: {{ portainer_agent_restart_policy }}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /var/lib/docker/volumes:/var/lib/docker/volumes:ro
      - {{ portainer_agent_data_directory }}:/data
    ports:
      - "{{ portainer_agent_port }}:9001"
    environment:
      - AGENT_CLUSTER_ADDR=0.0.0.0:9001
      - EDGE={{ portainer_agent_edge | lower }}
{% if portainer_agent_edge_key %}
      - EDGE_KEY={{ portainer_agent_edge_key }}
{% endif %}
{% if portainer_agent_edge_id %}
      - EDGE_ID={{ portainer_agent_edge_id }}
{% endif %}
      - LOG_LEVEL={{ portainer_agent_log_level }}
    networks:
      - portainer-agent-network

networks:
  portainer-agent-network:
    driver: bridge 