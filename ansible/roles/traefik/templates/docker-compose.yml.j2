services:
  traefik:
    image: "{{ traefik_image }}"
    container_name: "{{ traefik_container_name }}"
    restart: always
    command:
      - --configfile=/etc/traefik/traefik.yml
      - --providers.file.directory=/config
      - --providers.file.watch=true
    ports:
      - "{{ traefik_entrypoints.web.host_port }}:{{ traefik_entrypoints.web.container_port }}"
{% if traefik_ssl_enabled %}
      - "{{ traefik_entrypoints.websecure.host_port }}:{{ traefik_entrypoints.websecure.container_port }}"
{% endif %}
{% if traefik_dashboard_enabled and traefik_dashboard_expose_port %}
      - "{{ traefik_entrypoints.dashboard.host_port }}:{{ traefik_entrypoints.dashboard.container_port }}"
{% endif %}
    volumes:
      - "{{ traefik_data_dir }}/traefik.yml:/etc/traefik/traefik.yml:ro"
      - "{{ traefik_config_dir }}:/config:ro"
      - "{{ traefik_certs_dir }}:/certificates"
      - "/var/run/docker.sock:/var/run/docker.sock:ro"
    networks:
      - traefik-network
    labels:
      - "traefik.enable=false"  # Disable auto-discovery for Traefik itself - we manage routes manually via dynamic config

networks:
  traefik-network:
    name: "{{ traefik_network_name }}"
    external: true
